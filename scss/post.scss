// This file is part of Moodle - http://moodle.org/
//
// Moodle is free software: you can redistribute it and/or modify
// it under the terms of the GNU General Public License as published by
// the Free Software Foundation, either version 3 of the License, or
// (at your option) any later version.
//
// Moodle is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
// GNU General Public License for more details.
//
// You should have received a copy of the GNU General Public License
// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.

/**
 * Post SCSS for theme_ufpel.
 *
 * @package    theme_ufpel
 * @copyright  2025 Universidade Federal de Pelotas
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */

// ============================================================================
// Variables and Mixins
// ============================================================================

// UFPel specific variables
$ufpel-header-height: 250px !default;
$ufpel-header-height-md: 200px !default;
$ufpel-header-height-sm: 150px !default;
$ufpel-transition-speed: 0.3s !default;
$ufpel-transition-timing: ease-in-out !default;

// Mixins
@mixin ufpel-transition($properties...) {
    transition-property: $properties;
    transition-duration: $ufpel-transition-speed;
    transition-timing-function: $ufpel-transition-timing;
}

@mixin ufpel-hover-lift() {
    @include ufpel-transition(transform, box-shadow);
    
    &:hover {
        transform: translateY(-2px);
        box-shadow: $box-shadow;
    }
    
    &:active {
        transform: translateY(0);
        box-shadow: $box-shadow-sm;
    }
}

@mixin ufpel-text-shadow($size: medium) {
    @if $size == small {
        text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
    } @else if $size == large {
        text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.7);
    } @else {
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
    }
}

// ============================================================================
// Apply Theme Colors
// ============================================================================

// Body background color
body {
    background-color: $backgroundcolor !important;
    color: $contenttextcolor !important;
}

// Primary color on fixed header
.fixed-top {
    background-color: $primarycolor !important;
    color: $highlighttextcolor !important;
    
    a {
        color: $highlighttextcolor !important;
        @include ufpel-transition(opacity);
        
        &:hover {
            opacity: 0.8;
            text-decoration: none;
        }
    }
}

// Links use secondary color
a {
    color: $secondarycolor !important;
    text-decoration: none;
    @include ufpel-transition(color);
    
    &:hover {
        color: darken($secondarycolor, 10%) !important;
        text-decoration: underline;
    }
}

// Content text color
p, div, span, li, td, th {
    color: $contenttextcolor;
}

// Elements with primary background get highlight text color
.bg-primary,
.btn-primary,
.badge-primary,
.navbar,
.ufpel-course-header {
    color: $highlighttextcolor !important;
    
    * {
        color: $highlighttextcolor !important;
    }
}

// ============================================================================
// UFPel Course Header Styles
// ============================================================================

.ufpel-course-header {
    position: relative;
    width: 100%;
    height: $ufpel-header-height;
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    background-color: $primarycolor;
    margin-bottom: $spacer;
    overflow: hidden;
    border-radius: $border-radius-lg;
    
    @include media-breakpoint-down(md) {
        height: $ufpel-header-height-md;
    }
    
    @include media-breakpoint-down(sm) {
        height: $ufpel-header-height-sm;
        border-radius: $border-radius;
    }
    
    // Dark overlay for better text readability
    &.has-overlay .ufpel-course-header-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(
            to bottom, 
            rgba(0, 0, 0, 0.2) 0%, 
            rgba(0, 0, 0, 0.4) 50%, 
            rgba(0, 0, 0, 0.7) 100%
        );
        z-index: 1;
    }
    
    // Content container
    .ufpel-course-header-content {
        position: absolute;
        bottom: 0;
        left: 0;
        padding: $spacer * 2;
        z-index: 2;
        width: 100%;
        
        @include media-breakpoint-down(md) {
            padding: $spacer * 1.5;
        }
        
        @include media-breakpoint-down(sm) {
            padding: $spacer;
        }
        
        // Course title
        .ufpel-course-title {
            color: white;
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: $spacer * 0.5;
            line-height: 1.2;
            @include ufpel-text-shadow(medium);
            
            @include media-breakpoint-down(md) {
                font-size: 2rem;
            }
            
            @include media-breakpoint-down(sm) {
                font-size: 1.5rem;
                margin-bottom: $spacer * 0.25;
            }
        }
        
        // Teacher names
        .ufpel-course-teachers {
            color: rgba(255, 255, 255, 0.95);
            font-size: 1.1rem;
            margin-bottom: 0;
            @include ufpel-text-shadow(small);
            
            @include media-breakpoint-down(sm) {
                font-size: 1rem;
            }
        }
    }
}

// Hide default title when custom header is present
.has-course-header {
    #page-header .page-header-headings h1 {
        @include sr-only();
    }
}

// ============================================================================
// Login Page Customization
// ============================================================================

.pagelayout-login {
    // Login with background image
    &.has-login-background {
        #page {
            background: transparent;
            min-height: 100vh;
            display: flex;
            align-items: center;
        }
        
        .login-background-image {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
            // Background image will be set via inline styles in PHP
            // to avoid SCSS compilation issues with placeholders
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            
            .login-background-img {
                width: 100%;
                height: 100%;
                object-fit: cover;
                filter: brightness(0.6) blur(2px);
            }
        }
        
        .login-container {
            background-color: rgba(255, 255, 255, 0.96);
            border-radius: $border-radius-lg;
            box-shadow: $box-shadow-lg;
            padding: $spacer * 2;
            backdrop-filter: blur(10px);
            
            @include media-breakpoint-up(md) {
                padding: $spacer * 3;
            }
        }
        
        .login-heading {
            color: $primarycolor;
            font-weight: 600;
            margin-bottom: $spacer * 1.5;
        }
    }
    
    // Default login page (no background image)
    &:not(.has-login-background) {
        background-color: $gray-100;
        
        .login-container {
            background-color: white;
            border-radius: $border-radius-lg;
            box-shadow: $box-shadow;
            padding: $spacer * 2;
            
            @include media-breakpoint-up(md) {
                padding: $spacer * 3;
            }
        }
    }
    
    // HR divider style
    .hr-text {
        position: relative;
        border: 0;
        height: 1px;
        background-color: $gray-300;
        margin: $spacer * 1.5 0;
        
        &:before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: white;
            padding: 0 $spacer;
        }
    }
    
    // Login options styling
    .login-options {
        a {
            color: $secondarycolor;
            text-decoration: none;
            @include ufpel-transition(color);
            
            &:hover {
                color: darken($secondarycolor, 10%);
                text-decoration: underline;
            }
        }
    }
    
    // Login footer
    .login-footer {
        a {
            @include ufpel-transition(color);
            
            &:hover {
                color: $primarycolor !important;
            }
        }
    }
}

// ============================================================================
// Header and Navigation
// ============================================================================

.navbar {
    box-shadow: $box-shadow-sm;
    background-color: $primarycolor !important;
    
    &.fixed-top {
        backdrop-filter: blur(10px);
        background-color: $primarycolor !important;
    }
    
    .navbar-brand {
        font-weight: 700;
        font-size: 1.5rem;
        color: $highlighttextcolor !important;
        @include ufpel-transition(opacity);
        
        &:hover {
            opacity: 0.8;
        }
    }
    
    // All navbar links
    .navbar-nav .nav-link {
        color: $highlighttextcolor !important;
        
        &:hover {
            opacity: 0.8;
        }
    }
}

// ============================================================================
// Cards and Content Blocks
// ============================================================================

.card {
    @include ufpel-transition(box-shadow, transform);
    border: none;
    box-shadow: $box-shadow-sm;
    
    &:hover {
        box-shadow: $box-shadow;
        transform: translateY(-1px);
    }
    
    .card-header {
        background-color: rgba($primarycolor, 0.05);
        border-bottom-color: rgba($primarycolor, 0.1);
        font-weight: 600;
    }
}

// Activity cards
.activity-item {
    .activity-basis {
        @include ufpel-transition(background-color, transform);
        
        &:hover {
            background-color: rgba($secondarycolor, 0.05);
            transform: translateX(2px);
        }
    }
    
    .activity-icon {
        @include ufpel-transition(transform);
        
        &:hover {
            transform: scale(1.1);
        }
    }
}

// ============================================================================
// Buttons and Interactive Elements
// ============================================================================

.btn {
    @include ufpel-transition(all);
    font-weight: 500;
    text-transform: none;
    
    &:not(.btn-link):not(.btn-icon) {
        box-shadow: $box-shadow-sm;
        
        &:hover:not(:disabled) {
            transform: translateY(-1px);
            box-shadow: $box-shadow;
        }
        
        &:active {
            transform: translateY(0);
            box-shadow: none;
        }
    }
    
    &.btn-primary {
        background-color: $primarycolor;
        border-color: $primarycolor;
        color: $highlighttextcolor !important;
        
        &:hover:not(:disabled) {
            background-color: darken($primarycolor, 10%);
            border-color: darken($primarycolor, 10%);
        }
    }
    
    &.btn-secondary {
        background-color: $secondarycolor;
        border-color: $secondarycolor;
        color: white !important;
        
        &:hover:not(:disabled) {
            background-color: darken($secondarycolor, 10%);
            border-color: darken($secondarycolor, 10%);
        }
    }
}

// ============================================================================
// Forms
// ============================================================================

.form-control,
.custom-select {
    @include ufpel-transition(border-color, box-shadow);
    
    &:focus {
        border-color: $secondarycolor;
        box-shadow: 0 0 0 0.2rem rgba($secondarycolor, 0.25);
    }
}

// ============================================================================
// Course Content Area
// ============================================================================

#region-main {
    > .card {
        border: none;
        box-shadow: $box-shadow-sm;
        
        @include media-breakpoint-up(lg) {
            box-shadow: $box-shadow;
        }
    }
}

// ============================================================================
// Drawer
// ============================================================================

.drawer {
    box-shadow: $box-shadow-lg;
    
    .drawer-header {
        background-color: $primarycolor;
        color: $highlighttextcolor;
        
        h2 {
            color: $highlighttextcolor;
            font-weight: 600;
        }
    }
    
    .list-group-item {
        @include ufpel-transition(background-color);
        
        &:hover {
            background-color: rgba($secondarycolor, 0.05);
        }
        
        &.active {
            background-color: rgba($primarycolor, 0.1);
            border-color: $primarycolor;
            color: $primarycolor;
        }
    }
}

// ============================================================================
// Footer
// ============================================================================

#page-footer {
    background-color: $ufpel-dark;
    color: $ufpel-light;
    padding: $spacer * 2 0;
    margin-top: $spacer * 3;
    
    a {
        color: rgba(255, 255, 255, 0.8);
        text-decoration: none;
        @include ufpel-transition(color);
        
        &:hover {
            color: white;
            text-decoration: underline;
        }
    }
    
    .ufpel-footer-content {
        padding: $spacer 0;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        margin-bottom: $spacer;
    }
}

// ============================================================================
// Accessibility
// ============================================================================

// Focus visible styles
:focus-visible {
    outline: 3px solid $secondarycolor;
    outline-offset: 2px;
}

// Skip links
.skiplinks {
    a.skip {
        &:focus {
            position: fixed;
            left: 0;
            top: 0;
            z-index: $zindex-tooltip;
            background-color: $primarycolor;
            color: $highlighttextcolor;
            padding: $spacer * 0.5 $spacer;
            text-decoration: none;
            border-radius: 0 0 $border-radius 0;
            box-shadow: $box-shadow;
        }
    }
}

// Screen reader only content
.sr-only-focusable:focus {
    position: absolute;
    width: auto;
    height: auto;
    padding: $spacer * 0.5 $spacer;
    margin: 0;
    overflow: visible;
    clip: auto;
    white-space: nowrap;
    background-color: $primarycolor;
    color: $highlighttextcolor;
    text-decoration: none;
    border-radius: $border-radius;
    box-shadow: $box-shadow;
}

// ============================================================================
// Responsive Utilities
// ============================================================================

// High contrast mode
@media (prefers-contrast: high) {
    .btn {
        border-width: 2px;
    }
    
    .card {
        border: 2px solid $ufpel-dark;
    }
    
    .ufpel-course-header {
        .ufpel-course-header-content {
            .ufpel-course-title,
            .ufpel-course-teachers {
                @include ufpel-text-shadow(large);
                -webkit-text-stroke: 1px black;
            }
        }
    }
}

// Reduced motion
@media (prefers-reduced-motion: reduce) {
    *,
    *::before,
    *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
    }
}

// Dark mode preparation
@media (prefers-color-scheme: dark) {
    // Ready for future dark mode implementation
}

// ============================================================================
// Print Styles
// ============================================================================

@media print {
    // Hide non-essential elements
    .navbar,
    #nav-drawer,
    .drawer,
    #page-footer,
    .ufpel-course-header,
    .activity-navigation,
    .secondary-navigation {
        display: none !important;
    }
    
    // Optimize content for print
    #region-main {
        width: 100% !important;
        max-width: none !important;
        margin: 0 !important;
        box-shadow: none !important;
    }
    
    // Ensure links are visible
    a[href]:after {
        content: " (" attr(href) ")";
    }
    
    // Page breaks
    h1, h2, h3 {
        page-break-after: avoid;
    }
    
    pre, blockquote {
        page-break-inside: avoid;
    }
}